(this.webpackJsonp=this.webpackJsonp||[]).push([[68],{"1OWu":function(t,e,n){"use strict";n.d(e,"e",(function(){return r})),n.d(e,"a",(function(){return a})),n.d(e,"g",(function(){return d})),n.d(e,"c",(function(){return l})),n.d(e,"b",(function(){return c})),n.d(e,"i",(function(){return h})),n.d(e,"h",(function(){return f})),n.d(e,"f",(function(){return u})),n.d(e,"d",(function(){return m}));var s=n("7jeQ"),i=n.n(s),o=n("NmEs");const r=function(t){return Boolean(t&&t.scrollWidth>t.offsetWidth)},a=function(t,e){t&&t.classList.add(e)},d=function(){return Object(o.v)()||Object(o.t)()||Object(o.w)()},l=function({scrollTop:t},e=0){return t>e},c=function({scrollTop:t,offsetHeight:e,scrollHeight:n},s=0){return t+e<n-s},h=function(t,e){t&&Object.entries(e).map((function([e,n]){n?t.classList.add(e):t.classList.remove(e)}))},f=function({dataset:t},e){return e.reduce((function(e,n){return e[n]=i()(t,n),e}),{})},u=function(t){return Boolean(t.offsetWidth||t.offsetHeight||t.getClientRects().length)},m=function(t){const e=[];let n=t.parentNode;do{e.push(n),n=n.parentNode}while(n);return e}},"9RX+":function(t,e){t.exports=function(t){return t!=t}},GY8p:function(t,e){t.exports=function(t,e,n){for(var s=-1,i=null==t?0:t.length;++s<i;)if(n(e,t[s]))return!0;return!1}},KZGt:function(t,e){t.exports=function(){}},P9pc:function(t,e){t.exports=function(t,e,n){for(var s=n-1,i=t.length;++s<i;)if(t[s]===e)return s;return-1}},QPL1:function(t,e,n){var s=n("pFYY"),i=n("KZGt"),o=n("1XSk"),r=s&&1/o(new s([,-0]))[1]==1/0?function(t){return new s(t)}:i;t.exports=r},QPeP:function(t,e,n){var s=n("q+Dt");t.exports=function(t,e){return!!(null==t?0:t.length)&&s(t,e,0)>-1}},"dA+0":function(t,e,n){var s=n("4O6w"),i=n("QPeP"),o=n("GY8p"),r=n("5PFN"),a=n("QPL1"),d=n("1XSk"),l=200;t.exports=function(t,e,n){var c=-1,h=i,f=t.length,u=!0,m=[],p=m;if(n)u=!1,h=o;else if(f>=l){var g=e?null:a(t);if(g)return d(g);u=!1,h=r,p=new s}else p=e?[]:m;t:for(;++c<f;){var v=t[c],b=e?e(v):v;if(v=n||0!==v?v:0,u&&b==b){for(var j=p.length;j--;)if(p[j]===b)continue t;e&&p.push(b),m.push(v)}else h(p,b,n)||(p!==m&&p.push(b),m.push(v))}return m}},"q+Dt":function(t,e,n){var s=n("sjqF"),i=n("9RX+"),o=n("P9pc");t.exports=function(t,e,n){return e==e?o(t,e,n):s(t,i,n)}},rzCk:function(t,e,n){"use strict";n("S26F");var s=n("o4PY"),i=n.n(s),o=n("G3fq"),r=n.n(o),a=n("TBBL"),d=n("oCX2"),l=n("EmJ/"),c=n.n(l),h=n("06tH"),f=n.n(h),u=n("ewH8"),m=(n("uK44"),n("Gs6c")),p=n("FYnm"),g=n("Z5en"),v=n("7KAB"),b=n("tRCE"),j=n("/ode"),w=n("XRO8"),N=n("Jn9D"),y=n("FVJN"),C=n("2ibD"),_=n("NmEs"),E=n("bOix"),T=n("3twG"),k=n("/lV4"),x=n("QBXl");function F(t){return t.replace(/\r\n/g,"\n")}window.autosize=d.a;const $=3,D=/^\/\w+.*$/gm;class A{static initialize(t,e,n,s,i){this.instance||(this.instance=new A(t,e,n,s,i))}static getInstance(){return this.instance}constructor(t,e,n,s,i=N.b){this.updateTargetButtons=this.updateTargetButtons.bind(this),this.updateComment=this.updateComment.bind(this),this.visibilityChange=this.visibilityChange.bind(this),this.cancelDiscussionForm=this.cancelDiscussionForm.bind(this),this.onAddDiffNote=this.onAddDiffNote.bind(this),this.onAddImageDiffNote=this.onAddImageDiffNote.bind(this),this.setupDiscussionNoteForm=this.setupDiscussionNoteForm.bind(this),this.onReplyToDiscussionNote=this.onReplyToDiscussionNote.bind(this),this.removeNote=this.removeNote.bind(this),this.cancelEdit=this.cancelEdit.bind(this),this.updateNote=this.updateNote.bind(this),this.addDiscussionNote=this.addDiscussionNote.bind(this),this.addNoteError=this.addNoteError.bind(this),this.addNote=this.addNote.bind(this),this.resetMainTargetForm=this.resetMainTargetForm.bind(this),this.refresh=this.refresh.bind(this),this.keydownNoteText=this.keydownNoteText.bind(this),this.toggleCommitList=this.toggleCommitList.bind(this),this.postComment=this.postComment.bind(this),this.clearFlashWrapper=this.clearFlash.bind(this),this.onHashChange=this.onHashChange.bind(this),this.notes_url=t,this.note_ids=e,this.enableGFM=i,this.updatedNotesTrackingMap={},this.last_fetched_at=n,this.noteable_url=document.URL,this.notesCountBadge||(this.notesCountBadge=c()(".issuable-details").find(".notes-tab .badge")),this.basePollingInterval=15e3,this.maxPollingSteps=4,this.$wrapperEl=Object(_.w)()?c()(document).find(".diffs"):c()(document),this.cleanBinding(),this.addBinding(),this.setPollingInterval(),this.setupMainTargetNoteForm(i),this.taskList=new x.a({dataType:"note",fieldName:"note",selector:".notes"}),this.collapseLongCommitList(),this.setViewType(s),"merge_requests"===Object(_.m)(1)&&c()(".note-edit-form").clone().addClass("mr-note-edit-form").insertAfter(".note-edit-form");const o=Object(T.i)(),r=o&&document.getElementById(o);r&&this.loadLazyDiff({currentTarget:r})}setViewType(t){this.view=f.a.get("diff_view")||t}addBinding(){this.$wrapperEl.on("click",".js-note-edit",this.showEditForm.bind(this)),this.$wrapperEl.on("click",".note-edit-cancel",this.cancelEdit),this.$wrapperEl.on("click","input.js-comment-submit-button, .js-comment-submit-button > button:first-child",this.postComment),this.$wrapperEl.on("click",".js-comment-save-button",this.updateComment),this.$wrapperEl.on("keyup input",".js-note-text",this.updateTargetButtons),this.$wrapperEl.on("click",".js-comment-resolve-button",this.postComment),this.$wrapperEl.on("click",".js-note-delete",this.removeNote),this.$wrapperEl.on("click",".js-note-attachment-delete",this.removeAttachment),this.$wrapperEl.on("change",".js-note-attachment-input",this.updateFormAttachment),this.$wrapperEl.on("click",".js-discussion-reply-button",this.onReplyToDiscussionNote),this.$wrapperEl.on("click",".js-add-diff-note-button",this.onAddDiffNote),this.$wrapperEl.on("click",".js-add-image-diff-note-button",this.onAddImageDiffNote),this.$wrapperEl.on("click",".js-close-discussion-note-form",this.cancelDiscussionForm),this.$wrapperEl.on("click",".system-note-commit-list-toggler",this.toggleCommitList),this.$wrapperEl.on("click",".js-toggle-lazy-diff",this.loadLazyDiff),this.$wrapperEl.on("click",".js-toggle-lazy-diff-retry-button",this.onClickRetryLazyLoad.bind(this)),this.$wrapperEl.on("visibilitychange",this.visibilityChange),this.$wrapperEl.on("issuable:change",this.refresh),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.addNote),this.$wrapperEl.on("ajax:success",".js-discussion-note-form",this.addDiscussionNote),this.$wrapperEl.on("ajax:success",".js-main-target-form",this.resetMainTargetForm),this.$wrapperEl.on("ajax:complete",".js-main-target-form",this.reenableTargetFormSubmitButton),this.$wrapperEl.on("keydown",".js-note-text",this.keydownNoteText),c()(window).on("hashchange",this.onHashChange)}cleanBinding(){this.$wrapperEl.off("click",".js-note-edit"),this.$wrapperEl.off("click",".note-edit-cancel"),this.$wrapperEl.off("click",".js-note-delete"),this.$wrapperEl.off("click",".js-note-attachment-delete"),this.$wrapperEl.off("click",".js-discussion-reply-button"),this.$wrapperEl.off("click",".js-add-diff-note-button"),this.$wrapperEl.off("click",".js-add-image-diff-note-button"),this.$wrapperEl.off("visibilitychange"),this.$wrapperEl.off("keyup input",".js-note-text"),this.$wrapperEl.off("click",".js-note-target-reopen"),this.$wrapperEl.off("click",".js-note-target-close"),this.$wrapperEl.off("keydown",".js-note-text"),this.$wrapperEl.off("click",".js-comment-resolve-button"),this.$wrapperEl.off("click",".system-note-commit-list-toggler"),this.$wrapperEl.off("click",".js-toggle-lazy-diff"),this.$wrapperEl.off("click",".js-toggle-lazy-diff-retry-button"),this.$wrapperEl.off("ajax:success",".js-main-target-form"),this.$wrapperEl.off("ajax:success",".js-discussion-note-form"),this.$wrapperEl.off("ajax:complete",".js-main-target-form"),c()(window).off("hashchange",this.onHashChange)}static initCommentTypeToggle(t){const e=t.querySelector(".js-comment-type-dropdown"),{noteableName:n}=e.dataset,s=t.querySelector("#note_type"),i=t.querySelector(".js-note-text").value.trim().length>0;t.commentTypeComponent=new u.default({el:e,data:()=>({noteType:v.COMMENT,disabled:!i}),render(t){var e=this;return t(g.a,{props:{noteType:this.noteType,noteableDisplayName:n,disabled:this.disabled},on:{change:function(t){e.noteType=t,e.noteType===v.DISCUSSION?s.value=v.DISCUSSION_NOTE:s.value=""}}})}})}keydownNoteText(t){let e,n,s,i,o,r;if(Object(_.A)(t))return;const a=c()(t.target);switch(t.which){case 38:if(""!==a.val())return;if((s=c()(`li.note[data-author-id='${gon.current_user_id}'][data-editable]:last`,a.closest(".note, .notes_holder, #notes"))).length)return(i=s.find(".js-note-edit")).trigger("click",[!0,s]);break;case 27:if((e=a.closest(".js-discussion-note-form")).length){if(""!==a.val()&&!window.confirm(Object(k.a)("Your comment will be discarded.")))return;return void this.removeDiscussionNoteForm(e)}if((n=a.closest(".note")).length){if((r=a.closest("form").data("originalNote"))!==(o=a.val())&&!window.confirm(Object(k.a)("Are you sure you want to discard this comment?")))return;return this.removeNoteEditForm(n)}}}initRefresh(){var t=this;A.interval&&clearInterval(A.interval),A.interval=setInterval((function(){return t.refresh()}),this.pollingInterval)}refresh(){if(!document.hidden)return this.getContent()}getContent(){var t=this;this.refreshing||(this.refreshing=!0,C.a.get(`${this.notes_url}?html=true`,{headers:{"X-Last-Fetched-At":this.last_fetched_at}}).then((function({data:e}){const{notes:n}=e;t.last_fetched_at=e.last_fetched_at,t.setPollingInterval(e.notes.length),c.a.each(n,(function(e,n){return t.renderNote(n)})),t.refreshing=!1})).catch((function(){t.refreshing=!1})))}setPollingInterval(t){null==t&&(t=!0);const e=this.basePollingInterval*Math.pow(2,this.maxPollingSteps-1);return t?this.pollingInterval=this.basePollingInterval:this.pollingInterval<e&&(this.pollingInterval*=2),this.initRefresh()}handleQuickActions(t){let e;t.commands_changes&&("merge"in t.commands_changes&&A.checkMergeRequestStatus(),"emoji_award"in t.commands_changes&&(e=c()(".js-awards-block").eq(0),Object(j.b)().then((function(n){n.addAwardToEmojiBar(e,t.commands_changes.emoji_award),n.scrollToAwards()})).catch((function(){}))))}setupNewNote(t){Object(E.x)(t.find(".js-timeago").get(),!1),this.collapseLongCommitList(),this.taskList.init(),A.updateNoteTargetSelector(t),this.$noteToCleanHighlight=t}onHashChange(){this.$noteToCleanHighlight&&A.updateNoteTargetSelector(this.$noteToCleanHighlight),this.$noteToCleanHighlight=null}static updateNoteTargetSelector(t){const e=Object(T.i)(),n=Boolean(e&&t.filter(`#${e}`).length>0);t.toggleClass("target",n)}renderNote(t,e,n=c()(".main-notes-list")){if(t.discussion_html)return this.renderDiscussionNote(t,e);if(!t.valid)return void(t.errors&&t.errors.commands_only&&(t.commands_changes&&Object.keys(t.commands_changes).length>0&&n.find(".system-note.being-posted").remove(),this.addFlash({message:t.errors.commands_only,type:"notice",parent:this.parentTimeline.get(0)}),this.refresh()));const s=n.find(`#note_${t.id}`);if(A.isNewNote(t,this.note_ids)){if(Object(_.w)())return;this.note_ids.push(t.id),n.length&&n.find(".system-note.being-posted").remove();const e=A.animateAppendNote(t.html,n);return this.setupNewNote(e),this.refresh(),this.updateNotesCount(1)}if(A.isUpdatedNote(t,s)){const e=s.hasClass("is-editing"),n=F(s.find(".original-note-content").text().trim()),i=s.find(".js-note-text"),o=i.val(),r=F(t.note),a=o===n||o===r;if(e&&a)i.val(t.note),this.updatedNotesTrackingMap[t.id]=t;else if(e&&!a)this.putConflictEditWarningInPlace(t,s),this.updatedNotesTrackingMap[t.id]=t;else{const e=A.animateUpdateNote(t.html,s);this.setupNewNote(e)}}}isParallelView(){return"parallel"===f.a.get("diff_view")}renderDiscussionNote(t,e){let n,s;if(!A.isNewNote(t,this.note_ids))return;this.note_ids.push(t.id);const i=e||c()(`.js-discussion-note-form[data-discussion-id="${t.discussion_id}"]`);if(s=i.length||!t.discussion_line_code?i.closest("tr"):c()(`#${t.discussion_line_code}`),t.on_image&&(s=i),(n=c()(`.notes[data-discussion-id="${t.discussion_id}"]`)).length||(n=i.closest(".discussion").find(".notes")),0===n.length)if(t.diff_discussion_html){const e=c()(t.diff_discussion_html).renderGFM();if(!this.isParallelView()||s.hasClass("js-temp-notes-holder")||t.on_image)s.after(e);else{const n=e.find(`.notes[data-discussion-id="${t.discussion_id}"]`),i=n.closest(".notes-content").attr("class").split(" ").join(".");s.find(`.${i} .content`).append(n.closest(".content").children())}}else A.animateAppendNote(t.discussion_html,c()(".main-notes-list"));else A.animateAppendNote(t.html,n);return Object(E.x)(document.querySelectorAll(".js-timeago"),!1),A.checkMergeRequestStatus(),this.updateNotesCount(1)}getLineHolder(t){return c()(t).closest(".notes_holder").prevAll(".line_holder").first().get(0)}resetMainTargetForm(t){const e=c()(".js-main-target-form");e.find(".js-errors").remove(),e.find(".js-md-write-button").click(),e.find(".js-note-text").val("").trigger("input"),e.find(".js-note-text").data("autosave").reset();const n=document.createEvent("Event");n.initEvent("autosize:update",!0,!1),e.find(".js-autosize")[0].dispatchEvent(n),this.updateTargetButtons(t)}reenableTargetFormSubmitButton(){return c()(".js-main-target-form").find(".js-note-text").trigger("input")}setupMainTargetNoteForm(t){const e=c()(".js-new-note-form");this.formClone=e.clone(),this.setupNoteForm(e,t),e.removeClass("js-new-note-form"),e.addClass("js-main-target-form"),e.find("#note_line_code").remove(),e.find("#note_position").remove(),e.find("#note_type").val(""),e.find("#note_project_id").remove(),e.find("#in_reply_to_discussion_id").remove(),this.parentTimeline=e.parents(".timeline"),e.length&&A.initCommentTypeToggle(e.get(0))}setupNoteForm(t,e=N.b){this.glForm=new y.a(t,e);const n=t.find(".js-note-text"),s=[Object(k.f)("NoteForm|Note"),t.find("#note_noteable_type").val(),t.find("#note_noteable_id").val(),t.find("#note_commit_id").val(),t.find("#note_type").val(),t.find("#note_project_id").val(),t.find("#in_reply_to_discussion_id").val(),t.find("#note_line_code").val(),t.find("#note_position").val()];return new b.a(n,s)}addNote(t,e){return this.renderNote(e)}addNoteError(t){let e;return t.hasClass("js-main-target-form")?e=t.parents(".timeline"):t.hasClass("js-discussion-note-form")&&(e=t.closest(".discussion-notes").find(".notes")),this.addFlash({message:Object(k.a)("Your comment could not be submitted! Please check your network connection and try again."),parent:e.get(0)})}updateNoteError(){Object(w.c)({message:Object(k.a)("Your comment could not be updated! Please check your network connection and try again.")})}addDiscussionNote(t,e,n){if(null!=t.attr("data-resolve-all")){const e=t.data("discussionId"),n=t.data("noteableIid");null!=ResolveService&&ResolveService.toggleResolveForDiscussion(n,e)}this.renderNote(e,t),n&&this.removeDiscussionNoteForm(t)}updateNote(t,e){const n=c()(t.html),s=n.find(".image-diff-avatar-link"),i=e.find(".badge");s.append(i),this.revertNoteEditForm(e),n.renderGFM(),c()(`.note-row-${t.id}`).replaceWith(n),this.setupNewNote(n)}checkContentToAllowEditing(t){const e=t.find(".original-note-content").text().trim();let n=!0;if(t.find(".js-note-text").val()===e)this.removeNoteEditForm(t);else{Object(_.x)(t.get(0))||Object(_.K)(t),t.find(".js-finish-edit-warning").show(),n=!1}return n}showEditForm(t){t.preventDefault();const e=c()(t.target),n=c()(this.getEditFormSelector(e)),s=e.closest(".note"),i=c()(".note.is-editing:visible");if(i.length){if(!this.checkContentToAllowEditing(i))return}s.find(".js-note-attachment-delete").show(),n.addClass("current-note-edit-form"),s.addClass("is-editing"),this.putEditFormInPlace(e)}cancelEdit(t){t.preventDefault();const e=c()(t.target),n=e.closest(".note"),s=n.attr("data-note-id");if(this.revertNoteEditForm(e),this.updatedNotesTrackingMap[s]){const t=c()(this.updatedNotesTrackingMap[s].html);n.replaceWith(t),this.setupNewNote(t),delete this.updatedNotesTrackingMap[s]}else n.find(".js-finish-edit-warning").hide(),this.removeNoteEditForm(n)}revertNoteEditForm(t){t=t||c()(".note.is-editing:visible");const e=this.getEditFormSelector(t),n=c()(e);n.insertBefore(".diffs"),n.find(".js-comment-save-button").enable(),n.find(".js-finish-edit-warning").hide()}getEditFormSelector(t){let e=".note-edit-form:not(.mr-note-edit-form)";return t.parents("#diffs").length&&(e=".note-edit-form.mr-note-edit-form"),e}removeNoteEditForm(t){const e=t.find(".diffs .current-note-edit-form");return t.removeClass("is-editing"),e.removeClass("current-note-edit-form"),e.find(".js-finish-edit-warning").hide(),e.find(".js-note-text").val(e.find("form.edit-note").data("originalNote"))}removeNote(t){const e=c()(t.currentTarget).closest(".note").attr("id");return c()(`.note[id="${e}"]`).each((function(t,e){const n=c()(e),s=n.closest(".discussion-notes"),i=c()(".notes",s).data("discussionId");if(n.remove(),0===s.find(".note").length){const t=s.closest("tr");if(s.closest(".timeline-entry").remove(),c()(`.js-diff-avatars-${i}`).trigger("remove.vue"),t.find(".discussion-notes").length>1||0===t.length){const t=s.closest(".diff-file");if(t.length>0){const e=new CustomEvent("removeBadge.imageDiff",{detail:{badgeNumber:s.index()+1}});t[0].dispatchEvent(e)}s.remove()}else t.length>0&&t.remove()}})),A.checkMergeRequestStatus(),this.updateNotesCount(-1)}removeAttachment(){const t=c()(this).closest(".note");return t.find(".note-attachment").remove(),t.find(".note-body > .note-text").show(),t.find(".note-header").show(),t.find(".diffs .current-note-edit-form").remove()}onReplyToDiscussionNote(t){this.replyToDiscussionNote(t.target)}replyToDiscussionNote(t){const e=this.cleanForm(this.formClone.clone()),n=c()(t).closest(".js-discussion-reply-button");return n.closest(".discussion-reply-holder").hide().after(e),this.setupDiscussionNoteForm(n,e)}setupDiscussionNoteForm(t,e){let n=t.closest(".text-file");0===n.length&&(n=t.closest(".image"));const s=t.data("discussionId");s&&(e.attr("data-discussion-id",s),e.find("#in_reply_to_discussion_id").val(s)),e.find("#note_project_id").val(t.data("discussionProjectId")),e.attr("data-line-code",t.data("lineCode")),e.find("#line_type").val(t.data("lineType")),e.find("#note_noteable_type").val(n.data("noteableType")),e.find("#note_noteable_id").val(n.data("noteableId")),e.find("#note_commit_id").val(n.data("commitId")),e.find("#note_type").val(t.data("noteType")),e.find("#note_line_code").val(t.data("lineCode")),e.find("#note_position").val(t.attr("data-position")),e.append("</div>").find(".js-close-discussion-note-form").show().removeClass("hide"),e.find(".js-note-target-close").remove(),e.find(".js-note-new-discussion").remove(),this.setupNoteForm(e),e.removeClass("js-main-target-form").addClass("discussion-form js-discussion-note-form"),e.find(".js-note-text").focus(),e.find(".js-comment-resolve-button").attr("data-discussion-id",s)}onAddDiffNote(t){t.preventDefault();const e=t.currentTarget||t.target,n=c()(e),s=!n.hasClass("js-diff-comment-avatar");this.toggleDiffNote({target:n,lineType:e.dataset.lineType,showReplyInput:s,currentUsername:gon.current_username,currentUserAvatar:gon.current_user_avatar_url,currentUserFullname:gon.current_user_fullname})}onAddImageDiffNote(t){const e=c()(t.currentTarget||t.target),n=e.closest(".diff-file"),s=new CustomEvent("click.imageDiff",{detail:t});let i;n[0].dispatchEvent(s);const o=e.closest(".diff-viewer").find(".note-container"),r=o.find("> .discussion-form");0===r.length?(i=this.cleanForm(this.formClone.clone())).appendTo(o):i=r,this.setupDiscussionNoteForm(e,i)}toggleDiffNote({target:t,lineType:e,forceShow:n,showReplyInput:s=!1}){let i,o,r,a,d;const l=c()(t),h=l.closest("tr"),f=h.next();let u=h;f.is(".notes_holder")&&(u=f);const m=f.is(".notes_holder");i=!1;let p="";d='<tr class="notes_holder js-temp-notes-holder"><td class="notes-content" colspan="3"><div class="content"></div></td></tr>',this.isParallelView()&&(p=`.${e}`,d='<tr class="notes_holder js-temp-notes-holder"><td class="notes_line old"></td><td class="notes-content parallel old"><div class="content"></div></td><td class="notes_line new"></td><td class="notes-content parallel new"><div class="content"></div></td></tr>');const g=`.notes-content${p} .content`;let v=u.find(g);if(m&&s)u.show(),(v=u.find(g)).length&&(v.show(),(a=v.find(".js-discussion-reply-button:visible")).length?this.replyToDiscussionNote(a[0]):0===(r=v.find(".js-discussion-note-form")).length&&(i=!0));else if(s)h.after(d),v=(u=h.next()).find(g),i=!0;else{const t=u.find(".content:not(:empty)").is(":visible"),e=!0===n||!1===n,s=!0===n||!t&&!e;u.toggleClass("hide",!s),v.toggleClass("hide",!s)}if(i)return(o=this.cleanForm(this.formClone.clone())).appendTo(v),this.setupDiscussionNoteForm(l,o)}removeDiscussionNoteForm(t){const e=t.closest("tr");return t.data("glForm").destroy(),t.find(".js-note-text").data("autosave").reset(),t.prev(".discussion-reply-holder").show(),e.is(".js-temp-notes-holder")?e.remove():t.remove()}cancelDiscussionForm(t){t.preventDefault();const e=c()(t.target).closest(".js-discussion-note-form");if(0===c()(t.target).closest(".discussion-notes").length){const n=e.closest(".diff-file");if(n.length>0){const e=new CustomEvent("blur.imageDiff",{detail:t});n[0].dispatchEvent(e)}}return this.removeDiscussionNoteForm(e)}updateFormAttachment(){const t=c()(this).closest("form"),e=c()(this).val().replace(/^.*[\\\/]/,"");return t.find(".js-attachment-filename").text(e)}visibilityChange(){return this.refresh()}updateTargetButtons(t){var e;let n,s;const i=c()(t.target),o=i.parents("form"),r=o.find(".js-note-target-reopen"),a=o.find(".js-note-target-close"),d=null===(e=o.get(0))||void 0===e?void 0:e.commentTypeComponent;i.val().trim().length>0?(s=r.attr("data-alternative-text"),n=a.attr("data-alternative-text"),r.text()!==s&&r.text(s),a.text()!==n&&a.text(n),r.is(":not(.btn-comment-and-reopen)")&&r.addClass("btn-comment-and-reopen"),a.is(":not(.btn-comment-and-close)")&&a.addClass("btn-comment-and-close"),d&&(d.disabled=!1)):(s=r.data("originalText"),n=a.data("originalText"),r.text()!==s&&r.text(s),a.text()!==n&&a.text(n),r.is(".btn-comment-and-reopen")&&r.removeClass("btn-comment-and-reopen"),a.is(".btn-comment-and-close")&&a.removeClass("btn-comment-and-close"),d&&(d.disabled=!0))}putEditFormInPlace(t){const e=c()(this.getEditFormSelector(t)),n=t.closest(".note");e.insertAfter(n.find(".note-text"));const s=n.find(".original-note-content"),i=s.text().trim(),o=s.data("postUrl"),r=s.data("targetId"),a=s.data("targetType");this.glForm=new y.a(e.find("form"),this.enableGFM),e.find("form").attr("action",`${o}?html=true`).attr("data-remote","true"),e.find(".js-form-target-id").val(r),e.find(".js-form-target-type").val(a),e.find(".js-note-text").focus().val(i),e.find(".js-md-write-button").trigger("click"),e.find(".referenced-users").hide()}putConflictEditWarningInPlace(t,e){if(0===e.find(".js-conflict-edit-warning").length){const n=`<a href="#note_${t.id}" target="_blank" rel="noopener noreferrer">`;c()(`<div class="js-conflict-edit-warning alert alert-danger">\n        ${Object(k.g)(Object(k.f)("Notes|This comment has changed since you started editing, please review the %{open_link}updated comment%{close_link} to ensure information is not lost"),{open_link:n,close_link:"</a>"})}\n      </div>`).insertAfter(e.find(".note-text"))}}updateNotesCount(t){return this.notesCountBadge.text(parseInt(this.notesCountBadge.text(),10)+t)}static renderPlaceholderComponent(t){const e=t.find(".js-code-placeholder").get(0);new u.default({el:e,components:{GlSkeletonLoading:a.a},render:t=>t("gl-skeleton-loading")})}static renderDiffContent(t,e){const{discussion_html:n}=e,s=c()(n).find(".line_holder");s.addClass("fade-in"),t.find(".diff-content > table > tbody").prepend(s);const i=t.find(".file-holder");t.find(".line-holder-placeholder").remove(),Object(p.a)(i)}onClickRetryLazyLoad(t){const e=c()(t.currentTarget);return e.prop("disabled",!0),this.loadLazyDiff(t).then((function(){e.prop("disabled",!1)}))}loadLazyDiff(t){const e=c()(t.currentTarget).closest(".js-toggle-container");if(A.renderPlaceholderComponent(e),e.find(".js-toggle-lazy-diff").removeClass("js-toggle-lazy-diff"),0===e.find("tbody").length)return;const n=e.find(".file-holder").data("linesPath"),s=e.find(".js-error-lazy-load-diff"),i=e.find(".js-success-lazy-load");return n?C.a.get(n).then((function({data:t}){i.removeClass("hidden"),s.addClass("hidden"),A.renderDiffContent(e,t)})).catch((function(){i.addClass("hidden"),s.removeClass("hidden")})):Promise.resolve()}toggleCommitList(t){const e=c()(t.currentTarget),n=e.siblings(".system-note-commit-list"),s=e.find("svg.js-chevron-up"),i=e.find("svg.js-chevron-down");s.toggleClass("gl-display-none"),i.toggleClass("gl-display-none"),n.toggleClass("hide-shade")}collapseLongCommitList(){const t=c()("#notes-list").find("li.system-note").has("ul");c.a.each(t,(function(t,e){const n=c()(e),s=n.find(".note-text").find("p").first().text().replace(":","");n.find(".note-header .system-note-message").html(s),n.find("li").length>$?(n.find(".note-text").addClass("system-note-commit-list"),n.find(".system-note-commit-list-toggler").show()):n.find(".note-text").addClass("system-note-commit-list hide-shade")}))}addFlash(...t){this.flashContainer=Object(w.c)(...t)}clearFlash(){this.flashContainer&&(this.flashContainer.style.display="none",this.flashContainer=null)}cleanForm(t){return t.find(".dropdown-menu").remove(),t}static isNewNote(t,e){return-1===c.a.inArray(t.id,e)}static isUpdatedNote(t,e){return F(t.note.trim())!==F(e.find(".original-note-content").first().text().trim())}static checkMergeRequestStatus(){"merge_requests"===Object(_.m)(1)&&gl.mrWidget&&gl.mrWidget.checkStatus()}static animateAppendNote(t,e){const n=c()(t);return n.addClass("fade-in-full").renderGFM(),e.append(n),n}static animateUpdateNote(t,e){const n=c()(t);return n.addClass("fade-in").renderGFM(),e.replaceWith(n),n}getFormData(t){const e=t.find(".js-note-text").val();return{formData:t.serialize(),formContent:r()(e),formAction:t.attr("action"),formContentOriginal:e}}hasQuickActions(t){return D.test(t)}stripQuickActions(t){return t.replace(D,"").trim()}getQuickActionDescription(t,e=[]){let n;const s=e.filter((function(e){return new RegExp(`/${e.name}`).test(t)}));if(s&&s.length)if(s.length>1)n=Object(k.a)("Applying multiple commands");else{const t=s[0].description.toLowerCase();n=Object(k.g)(Object(k.a)("Applying command to %{commandDescription}"),{commandDescription:t})}else n=Object(k.a)("Applying command");return n}createPlaceholderNote({formContent:t,uniqueId:e,isDiscussionNote:n,currentUsername:s,currentUserFullname:i,currentUserAvatar:o}){const a=n?"discussion":"",d=c()(`<li id="${e}" class="note being-posted fade-in-half timeline-entry">\n         <div class="timeline-entry-inner">\n            <div class="timeline-icon">\n               <a href="/${r()(s)}">\n                 <img class="avatar s40" src="${o}" />\n               </a>\n            </div>\n            <div class="timeline-content ${a}">\n               <div class="note-header">\n                  <div class="note-header-info">\n                     <a href="/${r()(s)}">\n                       <span class="d-none d-sm-inline-block bold">${r()(s)}</span>\n                       <span class="note-headline-light">${r()(s)}</span>\n                     </a>\n                  </div>\n               </div>\n               <div class="note-body">\n                 <div class="note-text">\n                   <p>${t}</p>\n                 </div>\n               </div>\n            </div>\n         </div>\n      </li>`);return d.find(".d-none.d-sm-inline-block").text(r()(i)),d.find(".note-headline-light").text(`@${r()(s)}`),d}createPlaceholderSystemNote({formContent:t,uniqueId:e}){return c()(`<li id="${e}" class="note system-note timeline-entry being-posted fade-in-half">\n         <div class="timeline-entry-inner">\n           <div class="timeline-content">\n             <i>${t}</i>\n           </div>\n         </div>\n       </li>`)}postComment(t){var e,n=this;t.preventDefault();const s=c()(t.target);s.prop("disabled",!0);let o=s.parents("form");const r=null===(e=o.get(0))||void 0===e?void 0:e.commentTypeComponent;r&&(r.disabled=!0);const a=o.find(".js-note-target-close"),d="discussion"===s.parent().find("li.droplab-item-selected").attr("id"),l=o.hasClass("js-main-target-form"),h=o.hasClass("js-discussion-note-form"),f=s.hasClass("js-comment-resolve-button"),{formData:u,formContent:p,formAction:g,formContentOriginal:v}=this.getFormData(o);let b,j,w,N,y=!1;return h?w=o.parent(".discussion-notes").find(".notes"):l&&(w=c()("ul.main-notes-list")),f&&o.find(".js-comment-submit-button").disable(),N=p,this.glForm.supportsQuickActions&&this.hasQuickActions(p)&&(N=this.stripQuickActions(p),y=!0),N&&(b=i()("tempNote_"),w.append(this.createPlaceholderNote({formContent:N,uniqueId:b,isDiscussionNote:d,currentUsername:gon.current_username,currentUserFullname:gon.current_user_fullname,currentUserAvatar:gon.current_user_avatar_url}))),y&&(j=i()("tempSystemNote_"),w.append(this.createPlaceholderSystemNote({formContent:this.getQuickActionDescription(p,m.a.get(gl.GfmAutoComplete.dataSources.commands)),uniqueId:j}))),w.length&&(l?this.resetMainTargetForm(t):h&&this.removeDiscussionNoteForm(o)),a.text(a.data("originalText")),C.a.post(`${g}?html=true`,u).then((function(e){const i=e.data;s.prop("disabled",!1),r&&(r.disabled=!1),w.find(`#${b}`).remove();const a=o.closest(".diff-file");if(a.length>0){const e=new CustomEvent("blur.imageDiff",{detail:t});a[0].dispatchEvent(e)}if(y&&o.find("textarea.js-note-text").trigger("clear-commands-cache.atwho"),n.clearFlashWrapper(),h){w.find(".flash-container").remove(),f&&o.attr("data-discussion-id",s.data("discussionId")).attr("data-resolve-all","true").attr("data-project-path",s.data("projectPath"));const t=0===w.length;if(n.addDiscussionNote(o,i,t),t){const t=o.find("#note_position").val();if(a.length>0&&t.length>0){const{x:e,y:n,width:s,height:o}=JSON.parse(t),r=new CustomEvent("addBadge.imageDiff",{detail:{x:e,y:n,width:s,height:o,noteId:`note_${i.id}`,discussionId:i.discussion_id}});a[0].dispatchEvent(r)}}w.length&&w.append('<div class="flash-container" style="display: none;"></div>')}else l&&(n.addNote(o,i),n.reenableTargetFormSubmitButton(t));i.commands_changes&&n.handleQuickActions(i),o.trigger("ajax:success",[i])})).catch((function(){w.find(`#${b}`).remove(),s.prop("disabled",!1),r&&(r.disabled=!1);const e=new CustomEvent("blur.imageDiff",{detail:t}),i=o.closest(".diff-file");if(i.length&&i[0].dispatchEvent(e),y&&w.find(`#${j}`).remove(),h&&w.length){const t=w.parent().find(".js-discussion-reply-button");n.replyToDiscussionNote(t[0]),o=w.parent().find("form")}o.find(".js-note-text").val(v),n.reenableTargetFormSubmitButton(t),n.addNoteError(o)}))}updateComment(t){var e=this;t.preventDefault();const n=c()(t.target).parents("form"),s=n.find(".js-note-target-close"),i=n.parents(".note.is-editing"),o=i.find(".js-task-list-container").find(".note-text"),{formData:a,formContent:d,formAction:l}=this.getFormData(n),h=o.html();return o.html(d),i.removeClass("is-editing fade-in-full").addClass("being-posted fade-in-half"),i.find(".note-headline-meta a").html('<span class="spinner align-text-bottom"></span>'),C.a.post(`${l}?html=true`,a).then((function({data:t}){e.updateNote(t,i)})).catch((function(){o.html(r()(h)),i.removeClass("being-posted fade-in"),i.find(".gl-spinner").remove(),e.updateNoteError()})),s.text(s.data("originalText"))}}e.a=function(){const t=document.querySelector(".js-notes-data"),{notesUrl:e,notesIds:n,now:s,diffView:i,enableGFM:o}=JSON.parse(t.innerHTML);A.initialize(e,n,s,i,o)}},sjqF:function(t,e){t.exports=function(t,e,n,s){for(var i=t.length,o=n+(s?1:-1);s?o--:++o<i;)if(e(t[o],o,t))return o;return-1}}}]);
//# sourceMappingURL=commons-pages.projects.commit.show-pages.projects.snippets.show-pages.snippets.show.8b6988e3.chunk.js.map