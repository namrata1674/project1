(this.webpackJsonp=this.webpackJsonp||[]).push([[11],{FVJN:function(t,e,n){"use strict";n.d(e,"a",(function(){return k}));var o=n("oCX2"),r=n("EmJ/"),i=n.n(r),s=n("Jn9D"),a=n("NmEs"),c=(n("S26F"),n("G3fq")),l=n.n(c),u=n("ClPU"),d=n.n(u),f=(n("d8P8"),n("O4Ih")),h=n("0AwG"),p=n("/lV4");const m=function(t,e){return Math.max(...t.map((function(t){return t[e].length})))};class g{constructor(t){this.data=t,this.columnWidths=[],this.rows=[],this.tableFound=this.parseTable()}isTable(){return this.tableFound}convertToTableMarkdown(){var t=this;this.calculateColumnWidths();const e=this.rows.map((function(e){return`| ${e.map((function(e,n){return t.formatColumn(e,n)})).join(" | ")} |`}));return e.splice(1,0,this.generateHeaderBreak()),e.join("\n")}parseTable(){if(!this.data.types.includes("text/html")||!this.data.types.includes("text/plain"))return!1;const t=this.data.getData("text/html");if(this.doc=(new DOMParser).parseFromString(t,"text/html"),1!==this.doc.querySelectorAll("table:not(.diff-wrap-lines)").length)return!1;const e=this.data.getData("text/plain").trim().split(/[\n\u0085\u2028\u2029]|\r\n?/g);return this.doc.querySelectorAll("tr").length===e.length&&(this.rows=e.map((function(t){return t.split("\t")})),this.normalizeRows(),!!this.columnCountsMatch())}normalizeRows(){const t=this.rows.map((function(t){return t.length})),e=Math.max(...t);this.rows.forEach((function(t){for(;t.length<e;)t.push("")}))}calculateColumnWidths(){var t=this;this.columnWidths=this.rows[0].map((function(e,n){return m(t.rows,n)}))}columnCountsMatch(){const t=this.rows[0].length;let e=0;return this.doc.querySelectorAll("table tr").forEach((function(t){e=Math.max(t.cells.length,e)})),t===e}formatColumn(t,e){return t+Array(this.columnWidths[e]-t.length+1).join(" ")}generateHeaderBreak(){var t=this;return`|${this.columnWidths.map((function(e,n){return Array(t.columnWidths[n]+3).join("-")})).join("|")}|`}}var v=n("2ibD"),x=n("Qhxq");function w(t,e={parallelUploads:2}){const n=Object(a.N)("paperclip","div-dropzone-icon s24"),o=t.find(".button-attach-file"),r=t.find(".attaching-file-message"),s=t.find(".button-cancel-uploading-files"),c=t.find(".retry-uploading-link"),u=t.find(".uploading-progress"),m=t.find(".uploading-error-container"),w=t.find(".uploading-error-message"),b=t.find(".uploading-progress-container"),k=t.data("uploads-path")||window.uploads_path||null,C=gon.max_file_size||10,S=t.find(".js-gfm-input");let z,j,E,y,O;S.wrap('<div class="div-dropzone"></div>'),S.on("paste",(function(t){return z(t)}));const A=S.closest(".md-area");t.setupMarkdownPreview();const T=t.find(".div-dropzone");if(T.parent().addClass("div-dropzone-wrapper"),T.append('<div class="div-dropzone-hover"></div>'),T.find(".div-dropzone-hover").append(n),!k)return T.addClass("js-invalid-dropzone"),null;const _=T.dropzone({url:k,dictDefaultMessage:"",clickable:!0,paramName:"file",maxFilesize:C,uploadMultiple:!1,headers:x.a.headers,previewContainer:!1,...e,dragover:function(){A.addClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",.7)},dragleave:function(){A.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0)},drop:function(){A.removeClass("is-dropzone-hover"),t.find(".div-dropzone-hover").css("opacity",0),S.focus()},success(t,e){const n=this.getQueuedFiles().length+this.getUploadingFiles().length,r=n>=1;j(e.link.markdown,r),n||o.removeClass("hide"),E(e.link.url)},error:function(t,e=Object(p.a)("Attaching the file failed."),n){const r=(i=e||n.responseText)&&"string"!=typeof i?i.message:i;var i;m.removeClass("hide"),w.html(r),o.addClass("hide"),s.addClass("hide")},totaluploadprogress(t){y(this.files,r),u.text(`${Math.round(t)}%`)},sending:function(){o.addClass("hide"),m.addClass("hide"),b.removeClass("hide"),s.removeClass("hide")},removedfile:function(){o.removeClass("hide"),s.addClass("hide"),b.addClass("hide"),m.addClass("hide")},queuecomplete:function(){i()(".dz-preview").remove(),i()(".markdown-area").trigger("input"),b.addClass("hide"),s.addClass("hide")}}),D=i()(_[0]).children("textarea");s.on("click",(function(t){t.preventDefault(),t.stopPropagation(),d.a.forElement(T.get(0)).removeAllFiles(!0)})),c.on("click",(function(t){const e=d.a.forElement(t.target.closest(".js-main-target-form").querySelector(".div-dropzone")),n=e.files;t.preventDefault(),e.removeAllFiles(!0),n.map((function(t){const n=t;return n.status===d.a.ERROR&&(n.status=void 0,n.accepted=void 0),e.addFile(n)}))})),z=function(t){const e=t.originalEvent,{clipboardData:n}=e;if(n&&n.items){const e=new g(n);if(e.isTable()){t.preventDefault();const n=e.convertToTableMarkdown();j(n)}else{[...n.files].forEach((function(e){if(-1!==e.type.indexOf("image")){t.preventDefault();const n=246,o=Object(f.b)(e)||"image.png",r=Object(h.t)(o,n);j(`{{${r}}}`),O(e,r)}}))}}},j=function(t,e){let n=t;e&&(n+="\n\n");const o=D.get(0),r=o.selectionStart,s=o.selectionEnd,a=i()(D).val().length,c=i()(D).val().substring(0,r),l=i()(D).val().substring(s,a);return i()(D).val(c+n+l),o.setSelectionRange(r+n.length,s+n.length),o.style.height=`${o.scrollHeight}px`,S.get(0).dispatchEvent(new Event("input")),S.trigger("input")},E=function(e){i()(t).append(`<input type="hidden" name="files[]" value="${l()(e)}">`)};const F=function(){return b.addClass("hide")};return O=function(t,e){const n=new FormData;n.append("file",t,e),b.removeClass("hide"),v.a.post(k,n).then((function({data:t}){const n=t.link.markdown;!function(t,e){const n=i()(D),o=n.get(0),r=o.selectionStart,s=o.selectionEnd,a=`{{${t}}}`;n.val((function(t,n){return n.replace(a,e)})),o.setSelectionRange(r-a.length+e.length,s-a.length+e.length),n.trigger("change")}(e,n),F()})).catch((function(t){var e;e=t.response.data.message,m.removeClass("hide"),w.html(e),F()}))},y=function(t,e){const n=t.filter((function(t){return"uploading"===t.status||"queued"===t.status})).length,o=Object(p.e)("Attaching a file","Attaching %d files",n);e.text(`${o} -`)},t.find(".markdown-selector").click((function(t){t.preventDefault(),i()(this).closest(".gfm-form").find(".div-dropzone").click(),S.focus()})),T.get(0)?d.a.forElement(T.get(0)):null}d.a.autoDiscover=!1;var b=n("tXF7");class k{constructor(t,e={},n=!1){var o=this;this.form=t,this.textarea=this.form.find("textarea.js-gfm-input"),this.enableGFM={...s.b,...e};const r=gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources||{};Object.keys(this.enableGFM).forEach((function(t){"emojis"===t||r[t]||(o.enableGFM[t]=!1)})),this.destroy(),this.setupForm(n),this.form.data("glForm",this)}destroy(){this.clearEventListeners(),this.autoComplete&&this.autoComplete.destroy(),this.formDropzone&&this.formDropzone.destroy(),this.form.data("glForm",null)}setupForm(t=!1){const e=this.form.is(":not(.gfm-form)")||t;this.form.removeClass("js-new-note-form"),e&&(this.form.find(".div-dropzone").remove(),this.form.addClass("gfm-form"),Object(a.j)(this.form.find(".js-note-text"),this.form.find(".js-comment-button, .js-note-new-discussion")),this.autoComplete=new s.a(gl.GfmAutoComplete&&gl.GfmAutoComplete.dataSources),this.autoComplete.setup(this.form.find(".js-gfm-input"),this.enableGFM),this.formDropzone=w(this.form,{parallelUploads:1}),Object(o.a)(this.textarea)),this.addEventListeners(),Object(b.b)(this.form),this.form.show(),this.isAutosizeable&&this.setupAutosize(),!0===this.textarea.data("autofocus")&&this.textarea.focus()}setupAutosize(){var t=this;this.textarea.off("autosize:resized").on("autosize:resized",this.setHeightData.bind(this)),this.textarea.off("mouseup.autosize").on("mouseup.autosize",this.destroyAutosize.bind(this)),setTimeout((function(){Object(o.a)(t.textarea),t.textarea.css("resize","vertical")}),0)}setHeightData(){this.textarea.data("height",this.textarea.outerHeight())}destroyAutosize(){const t=this.textarea.outerHeight();this.textarea.data("height")!==t&&(o.a.destroy(this.textarea),this.textarea.data("height",t),this.textarea.outerHeight(t),this.textarea.css("max-height",window.outerHeight))}clearEventListeners(){this.textarea.off("focus"),this.textarea.off("blur"),Object(b.c)(this.form)}addEventListeners(){this.textarea.on("focus",(function(){i()(this).closest(".md-area").addClass("is-focused")})),this.textarea.on("blur",(function(){i()(this).closest(".md-area").removeClass("is-focused")}))}get supportsQuickActions(){return Boolean(this.textarea.data("supports-quick-actions"))}}},O4Ih:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r}));n("S26F");e.a=function(t,e){const n=document.querySelector(t),o=document.querySelector(e);if(!n||!o)return;const r=n.closest("form");n.addEventListener("click",(function(){o.click()})),o.addEventListener("change",(function(){r.querySelector(".js-filename").textContent=o.value.replace(/^.*[\\\/]/,"")}))};const o=function(t){let e;return t&&(e=t.name),e},r=function(t){const e=t.name?t.name:"image.png";return/^[\w.\-+]+\.(png|jpg|jpeg|gif|bmp|tiff|ico|webp)$/.test(e)?e:"image.png"}},Ylta:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var o=n("ClPU"),r=n.n(o),i=n("EmJ/"),s=n.n(i),a=n("t6Yz"),c=n.n(a),l=(n("U6io"),n("NmEs"));r.a.autoDiscover=!1;class u{constructor(){var t=this;this.active_backdrop=null,this.active_textarea=null,s()(document).on("click",".js-zen-enter",(function(t){return t.preventDefault(),s()(t.currentTarget).trigger("zen_mode:enter")})),s()(document).on("click",".js-zen-leave",(function(t){return t.preventDefault(),s()(t.currentTarget).trigger("zen_mode:leave")})),s()(document).on("zen_mode:enter",(function(e){t.enter(s()(e.target).closest(".md-area").find(".zen-backdrop"))})),s()(document).on("zen_mode:leave",(function(){t.exit()})),s()(document).on("keydown",(function(t){if(27===t.keyCode)return t.preventDefault(),s()(document).trigger("zen_mode:leave")}))}enter(t){c.a.pause(),this.active_backdrop=s()(t),this.active_backdrop.addClass("fullscreen"),this.active_textarea=this.active_backdrop.find("textarea"),this.active_textarea.removeAttr("style"),this.active_textarea.focus()}exit(){if(this.active_textarea){c.a.unpause(),this.active_textarea.closest(".zen-backdrop").removeClass("fullscreen"),Object(l.K)(this.active_textarea,{duration:0,offset:-100}),this.active_textarea=null,this.active_backdrop=null;const t=s()(".div-dropzone");t&&!t.hasClass("js-invalid-dropzone")&&r.a.forElement(".div-dropzone").enable()}}}},tXF7:function(t,e,n){"use strict";n.d(e,"b",(function(){return p})),n.d(e,"a",(function(){return m})),n.d(e,"c",(function(){return g}));n("S26F"),n("pETN");var o=n("EmJ/"),r=n.n(o),i=n("v+Mp"),s=n("NmEs");const a="[{text}](url)";function c(t,e){return`${t}\n${e}\n${t}`}function l(t){return{start:{row:(e=t.getSelection()).startLineNumber,column:e.startColumn},end:{row:e.endLineNumber,column:e.endColumn}};var e}function u({textArea:t,text:e,tag:n,cursorOffset:o,blockTag:r,selected:i="",wrap:u,select:d,editor:f}){let h,p,m,g,v=!1,x=!1,w=!1;if(i=i.toString(),f){const t=l(f);h=t.start,p=t.end}if(n===a&&URL)try{new URL(i),n="[text]({text})",d="text"}catch(t){}0===i.indexOf("\n")&&(x=!0,i=i.replace(/\n+/,"")),t?t.selectionEnd-t.selectionStart>i.replace(/\n$/,"").length&&(v=!0,i=i.replace(/\n$/,"")):f&&h.row!==p.row&&(v=!0,i=i.replace(/\n$/,""));const b=i.split("\n");f&&!u?(m=f.getValue().split("\n")[h.row],/^\s*$/.test(m)&&(w=!0)):t&&!u&&(m=t.value.substr(0,t.selectionStart).lastIndexOf("\n"),/^\s*$/.test(t.value.substring(m,t.selectionStart))&&(w=!0));const k=t&&0===t.selectionStart||f&&0===h.column&&0===h.row,C=u||w||k?"":"\n";return g=b.length>1&&(!u||null!=r&&""!==r)?null!=r&&""!==r?f?function(t,e,n,o){const r=t.split("\n"),i=l(o);if(r[i.start.row-1]===e&&r[i.end.row+1]===e){if(null!==e){const t=r[i.end.row+1],e=new Range(r[i.start.row-1],0,i.end.row+1,t.length);o.getSelection().setSelectionRange(e)}return n}return c(e,n)}(e,r,i,f):function(t,e,n,o){return function(t,e){const n=t.substring(0,e.selectionStart).trim().split("\n");return n[n.length-1]}(t,e)===n&&function(t,e){return t.substring(e.selectionEnd).trim().split("\n")[0]}(t,e)===n?(null!=n&&(e.selectionStart=e.selectionStart-(n.length+1),e.selectionEnd=e.selectionEnd+(n.length+1)),o):c(n,o)}(e,t,r,i):b.map((function(t){return n.indexOf("{text}")>-1?n.replace("{text}",t):0===t.indexOf(n)?String(t.replace(n,"")):String(n)+t})).join("\n"):n.indexOf("{text}")>-1?n.replace("{text}",(function(){return i.replace(/\\n/g,"\n").replace(/%br/g,"\\n")})):String(C)+n+i+(u?n:""),x&&(g=`\n${g}`),v&&(g+="\n"),f?f.replaceSelectedText(g,d):Object(s.r)(t,g),function({textArea:t,tag:e,cursorOffset:n,positionBetweenTags:o,removedLastNewLine:r,select:i,editor:s,editorSelectionStart:a,editorSelectionEnd:c}){let l;if(!t||t.setSelectionRange){if(i&&i.length>0){if(t){const n=t.selectionStart-(e.length-e.indexOf(i)),o=n+i.length;return t.setSelectionRange(n,o)}if(s)return void s.selectWithinSelection(i,e)}if(t){if(t.selectionStart===t.selectionEnd)return l=o?t.selectionStart-e.length:t.selectionStart,r&&(l-=1),n&&(l-=n),t.setSelectionRange(l,l)}else s&&a.row===c.row&&o&&s.moveCursor(-1*e.length)}}({textArea:t,tag:n.replace("{text}",i),cursorOffset:o,positionBetweenTags:u&&0===i.length,removedLastNewLine:v,select:d,editor:f,editorSelectionStart:h,editorSelectionEnd:p})}function d({textArea:t,tag:e,cursorOffset:n,blockTag:o,wrap:i,select:s,tagContent:a}){const c=r()(t);t=c.get(0);const l=c.val(),d=function(t,e){return t.substring(e.selectionStart,e.selectionEnd)}(l,t)||a;return c.focus(),u({textArea:t,text:l,tag:e,cursorOffset:n,blockTag:o,selected:d,wrap:i,select:s})}function f(t){if(!gon.markdown_surround_selection)return;if(this.selectionStart===this.selectionEnd)return;const e={"*":"**{text}**",_:"_{text}_","`":"`{text}`","'":"'{text}'",'"':'"{text}"',"[":"[{text}]","{":"{{text}}","(":"({text})","<":"<{text}>"}[t.key];e&&(t.preventDefault(),d({tag:e,textArea:this,blockTag:"",wrap:!0,select:"",tagContent:""}))}function h(t){return d({textArea:t.closest(".md-area").find("textarea"),tag:t.data("mdTag"),cursorOffset:t.data("mdCursorOffset"),blockTag:t.data("mdBlock"),wrap:!t.data("mdPrepend"),select:t.data("mdSelect"),tagContent:t.attr("data-md-tag-content")})}function p(t){return r()(".markdown-area",t).on("keydown",f).each((function(){i.default.initMarkdownEditorShortcuts(r()(this),h)})),r()(".js-md",t).off("click").on("click",(function(){return h(r()(this))}))}function m(t){r()(".js-md").off("click").on("click",(function(e){const{mdTag:n,mdBlock:o,mdPrepend:i,mdSelect:s}=r()(e.currentTarget).data();u({tag:n,blockTag:o,wrap:!i,select:s,selected:t.getSelectedText(),text:t.getValue(),editor:t}),t.focus()}))}function g(t){return r()(".markdown-area",t).off("keydown",f).each((function(){i.default.removeMarkdownEditorShortcuts(r()(this))})),r()(".js-md",t).off("click")}}}]);
//# sourceMappingURL=commons-pages.admin.topics.edit-pages.admin.topics.new-pages.groups.milestones.edit-pages.groups.mil-8657eee6.4f143099.chunk.js.map